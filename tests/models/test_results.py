import pytest

from tests.utils import does_not_raise
from tokenflood.models.results import Results


@pytest.mark.parametrize(
    "prompts, generated_texts, latencies, expected_input_lengths, "
    "expected_prefix_lengths, expected_output_lengths, "
    "measured_input_lengths, measured_prefix_lengths, "
    "measured_output_lengths, expectation",
    [
        (
            ("A",),
            ("B",),
            (100,),
            (1024,),
            (128,),
            (16,),
            (512,),
            (128,),
            (16,),
            does_not_raise(),
        ),
        (
            ("A",),
            ("B",),
            (100, 100),
            (1024,),
            (128,),
            (16,),
            (512,),
            (128,),
            (16,),
            pytest.raises(ValueError),
        ),
        (
            ("A",),
            ("B",),
            (100,),
            (1024,),
            (),
            (16,),
            (512,),
            (128,),
            (16,),
            pytest.raises(ValueError),
        ),
        (
            ("A",),
            ("B",),
            (-100,),
            (1024,),
            (128,),
            (16,),
            (512,),
            (128,),
            (16,),
            pytest.raises(ValueError),
        ),
        (
            ("A",),
            ("B",),
            (100,),
            (-1024,),
            (128,),
            (16,),
            (512,),
            (128,),
            (16,),
            pytest.raises(ValueError),
        ),
        (
            ("A",),
            ("B",),
            (100,),
            (1024,),
            (-128,),
            (16,),
            (512,),
            (128,),
            (16,),
            pytest.raises(ValueError),
        ),
        (
            ("A",),
            ("B",),
            (100,),
            (1024,),
            (128,),
            (-16,),
            (512,),
            (128,),
            (16,),
            pytest.raises(ValueError),
        ),
        (
            ("A",),
            ("B",),
            (100,),
            (1024,),
            (128,),
            (16,),
            (-512,),
            (128,),
            (16,),
            pytest.raises(ValueError),
        ),
        (
            ("A",),
            ("B",),
            (100,),
            (1024,),
            (128,),
            (16,),
            (512,),
            (-128,),
            (16,),
            pytest.raises(ValueError),
        ),
        (
            ("A",),
            ("B",),
            (100,),
            (1024,),
            (128,),
            (16,),
            (512,),
            (128,),
            (-16,),
            pytest.raises(ValueError),
        ),
    ],
)
def test_result_validation(
    prompts,
    generated_texts,
    latencies,
    expected_input_lengths,
    expected_prefix_lengths,
    expected_output_lengths,
    measured_input_lengths,
    measured_prefix_lengths,
    measured_output_lengths,
    expectation,
):
    with expectation:
        Results(
            prompts=prompts,
            generated_texts=generated_texts,
            latencies=latencies,
            expected_input_lengths=expected_input_lengths,
            expected_prefix_lengths=expected_prefix_lengths,
            expected_output_lengths=expected_output_lengths,
            measured_input_lengths=measured_input_lengths,
            measured_prefix_lengths=measured_prefix_lengths,
            measured_output_lengths=measured_output_lengths,
        )
